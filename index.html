<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrÃ² ChÆ¡i VPIC Äá»• XÃºc Xáº¯c Chá»n MÃ³n Ä‚n TrÆ°a</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      padding: 20px;
    }
    #app {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 2rem;
      width: 100%;
      max-width: 500px;
      position: relative;
      overflow: hidden;
    }
    #dice-container {
      width: 150px;
      height: 150px;
      margin: 0 auto;
    }
    #food-chart {
      width: 100%;
      height: 200px;
      background: #f8f9fa;
      border-radius: 10px;
      padding: 10px;
    }
    #reset-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(45deg, #ff4d4d, #ff7878);
      color: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(255, 77, 77, 0.3);
      transition: transform 0.2s ease;
    }
    #reset-button:hover {
      transform: scale(1.1);
      background: linear-gradient(45deg, #ff7878, #ff4d4d);
    }
    .btn {
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .screen {
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .screen.hidden {
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
    }
    .list-item {
      transition: all 0.3s ease;
    }
    .list-item:hover {
      background-color: #f1f5f9;
      transform: translateX(5px);
    }
    h1, h2 {
      color: #2d3748;
    }
    input, button {
      border-radius: 10px !important;
    }
    /* Hiá»‡u á»©ng nháº¥p nhÃ¡y */
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    .blink {
      animation: blink 2s infinite;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- MÃ n hÃ¬nh Ä‘Äƒng nháº­p -->
    <div id="login-screen" class="screen space-y-6">
      <h1 class="text-3xl font-bold text-center text-gray-800">ChÃ o Má»«ng Äáº¿n Vá»›i TrÃ² ChÆ¡i TrÆ°a Mai Äá»›p GÃ¬?</h1>
      <p class="blink text-sm italic text-center text-yellow-500">Má»™t con game Bá»‘ Äá»i do Mr Ãnh #07897 phÃ¡t triá»ƒn ğŸ˜</p>
      <input id="player-name" type="text" placeholder="NÃ©m cÃ¡i tÃªn cÃºng cÆ¡m vÃ o Ä‘Ã¢y" class="w-full p-3 border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none">
      <button onclick="login()" class="btn w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700">Báº¯t Ä‘áº§u Thá»­ Váº­n May</button>
    </div>

    <!-- MÃ n hÃ¬nh chÃ­nh -->
    <div id="main-screen" class="screen hidden space-y-6">
      <h1 class="text-3xl font-bold text-center text-gray-800">THÃŠM MÃ“N & Äá»” XÃšC Xáº®C Äá»‚ QUYáº¾T Äá»ŠNH Bá»®A TRÆ¯A Báº°NG NHÃ‚N PHáº¨M ğŸ‘‡</h1>
      <p id="welcome-message" class="text-center text-gray-600"></p>
      <div id="dice-container" class="relative"></div>
      <button onclick="rollDice()" class="btn w-full bg-green-600 text-white p-3 rounded-lg hover:bg-green-700">Äá»• XÃºc Xáº¯c</button>
      <p id="result" class="text-center font-semibold text-lg text-gray-700"></p>
      <div class="space-y-3">
        <input id="new-food" type="text" placeholder="ThÃªm mÃ³n Äƒn má»›i" class="w-full p-3 border border-gray-300 focus:ring-2 focus:ring-purple-400 focus:outline-none">
        <button onclick="addFood()" class="btn w-full bg-purple-600 text-white p-3 rounded-lg hover:bg-purple-700">ThÃªm MÃ³n</button>
      </div>
      <h2 class="text-xl font-semibold text-gray-700">Danh SÃ¡ch MÃ³n Ä‚n</h2>
      <ul id="food-list" class="list-disc pl-5 space-y-2"></ul>
      <h2 class="text-xl font-semibold text-gray-700">Lá»‹ch Sá»­ Chá»n MÃ³n</h2>
      <ul id="history" class="list-disc pl-5 space-y-2"></ul>
      <h2 class="text-xl font-semibold text-gray-700">Thá»‘ng KÃª MÃ³n Ä‚n</h2>
      <p id="most-selected-food" class="blink text-lg font-bold text-center text-red-600 bg-yellow-100 p-3 rounded-lg"></p>
      <div class="flex space-x-3">
        <button onclick="showTop5Foods()" class="btn w-full bg-gray-600 text-white p-2 rounded-lg hover:bg-gray-700">Top 5 MÃ³n</button>
        <button onclick="showAllFoods()" class="btn w-full bg-gray-600 text-white p-2 rounded-lg hover:bg-gray-700">Hiá»ƒn Thá»‹ Táº¥t Cáº£</button>
      </div>
      <canvas id="food-chart"></canvas>
      <div class="flex space-x-3">
        <button onclick="goToFinance()" class="btn w-full bg-yellow-600 text-white p-3 rounded-lg hover:bg-yellow-700">Tá»”NG THIá»†T Háº I ğŸ’¸</button>
      </div>
      <div id="reset-button" onclick="resetGame()" title="LÃ m má»›i">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9H0m0 0v5h4.582M12 4a8 8 0 110 16 8 8 0 010-16z"></path>
        </svg>
      </div>
    </div>

    <!-- MÃ n hÃ¬nh thu chi -->
    <div id="finance-screen" class="screen hidden space-y-6">
      <h1 class="text-3xl font-bold text-center text-gray-800">Liá»‡t KÃª Háº­u Quáº£</h1>
      <div class="space-y-3">
        <input id="expense-description" type="text" placeholder="MÃ´ táº£ nguyÃªn váº­t liá»‡u" class="w-full p-3 border border-gray-300 focus:ring-2 focus:ring-purple-400 focus:outline-none">
        <input id="expense-amount" type="number" placeholder="Sá»‘ tiá»n (VND)" class="w-full p-3 border border-gray-300 focus:ring-2 focus:ring-purple-400 focus:outline-none">
        <button onclick="addExpense()" class="btn w-full bg-purple-600 text-white p-3 rounded-lg hover:bg-purple-700">ThÃªm Chi PhÃ­</button>
      </div>
      <div class="space-y-3">
        <input id="number-of-participants" type="number" placeholder="Sá»‘ ngÆ°á»i tham gia Äƒn" class="w-full p-3 border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none" min="1">
      </div>
      <h2 class="text-xl font-semibold text-gray-700">Thá»‘ng KÃª Thu Chi</h2>
      <ul id="expense-list" class="list-disc pl-5 space-y-2"></ul>
      <p id="total-expense" class="text-center font-bold text-gray-800"></p>
      <p id="per-person-expense" class="text-center font-medium text-gray-600"></p>
      <button onclick="goToMain()" class="btn w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700">Quay Láº¡i</button>
    </div>
  </div>

  <script>
    const socket = io('https://treasure-rightful-scallion.glitch.me');

    let playerName = '';
    let foods = [];
    let history = [];
    let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    let foodResults = {};
    let foodChart;
    let showingTop5 = false;

    // Nháº­n dá»¯ liá»‡u ban Ä‘áº§u tá»« server
    socket.on('initData', (data) => {
      foods = data.foods;
      history = data.history;
      foodResults = data.foodResults;
      updateFoodList();
      updateHistory();
      if (foodChart) {
        updateFoodChart();
      }
    });

    // Nháº­n cáº­p nháº­t tá»« server
    socket.on('updateFoods', (newFoods) => {
      foods = newFoods;
      updateFoodList();
      updateFoodChart();
    });

    socket.on('updateHistory', (newHistory) => {
      history = newHistory;
      updateHistory();
    });

    socket.on('updateFoodResults', (newFoodResults) => {
      foodResults = newFoodResults;
      updateFoodChart();
    });

    // Khá»Ÿi táº¡o foodResults
    function initFoodResults() {
      foods.forEach(food => {
        if (!(food.name in foodResults)) {
          foodResults[food.name] = 0;
        }
      });
    }

    // Three.js setup for 3D dice
    let scene, camera, renderer, dice;
    let isRolling = false;

    function initDice() {
      const container = document.getElementById('dice-container');
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, 150 / 150, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ alpha: true });
      renderer.setSize(150, 150);
      container.appendChild(renderer.domElement);

      // Ãnh sÃ¡ng
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(0, 1, 1);
      scene.add(directionalLight);

      // XÃºc xáº¯c vá»›i texture
      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshPhongMaterial({ color: 0xffffff, shininess: 100 });
      dice = new THREE.Mesh(geometry, material);
      scene.add(dice);

      // ThÃªm cháº¥m trÃªn xÃºc xáº¯c
      const dotGeometry = new THREE.SphereGeometry(0.05, 16, 16);
      const dotMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });

      const dot1 = new THREE.Mesh(dotGeometry, dotMaterial);
      dot1.position.set(0, 0, 0.51);
      dice.add(dot1);

      const dot2a = new THREE.Mesh(dotGeometry, dotMaterial);
      dot2a.position.set(-0.2, 0.2, -0.51);
      const dot2b = new THREE.Mesh(dotGeometry, dotMaterial);
      dot2b.position.set(0.2, -0.2, -0.51);
      dice.add(dot2a);
      dice.add(dot2b);

      const dot3a = new THREE.Mesh(dotGeometry, dotMaterial);
      dot3a.position.set(-0.2, 0.2, 0.51);
      const dot3b = new THREE.Mesh(dotGeometry, dotMaterial);
      dot3b.position.set(0, 0, 0.51);
      const dot3c = new THREE.Mesh(dotGeometry, dotMaterial);
      dot3c.position.set(0.2, -0.2, 0.51);
      dice.add(dot3a);
      dice.add(dot3b);
      dice.add(dot3c);

      const dot4a = new THREE.Mesh(dotGeometry, dotMaterial);
      dot4a.position.set(-0.2, 0.2, -0.51);
      const dot4b = new THREE.Mesh(dotGeometry, dotMaterial);
      dot4b.position.set(0.2, 0.2, -0.51);
      const dot4c = new THREE.Mesh(dotGeometry, dotMaterial);
      dot4c.position.set(-0.2, -0.2, -0.51);
      const dot4d = new THREE.Mesh(dotGeometry, dotMaterial);
      dot4d.position.set(0.2, -0.2, -0.51);
      dice.add(dot4a);
      dice.add(dot4b);
      dice.add(dot4c);
      dice.add(dot4d);

      const dot5a = new THREE.Mesh(dotGeometry, dotMaterial);
      dot5a.position.set(-0.2, 0.2, 0.51);
      const dot5b = new THREE.Mesh(dotGeometry, dotMaterial);
      dot5b.position.set(0.2, 0.2, 0.51);
      const dot5c = new THREE.Mesh(dotGeometry, dotMaterial);
      dot5c.position.set(0, 0, 0.51);
      const dot5d = new THREE.Mesh(dotGeometry, dotMaterial);
      dot5d.position.set(-0.2, -0.2, 0.51);
      const dot5e = new THREE.Mesh(dotGeometry, dotMaterial);
      dot5e.position.set(0.2, -0.2, 0.51);
      dice.add(dot5a);
      dice.add(dot5b);
      dice.add(dot5c);
      dice.add(dot5d);
      dice.add(dot5e);

      const dot6a = new THREE.Mesh(dotGeometry, dotMaterial);
      dot6a.position.set(-0.2, 0.2, -0.51);
      const dot6b = new THREE.Mesh(dotGeometry, dotMaterial);
      dot6b.position.set(0.2, 0.2, -0.51);
      const dot6c = new THREE.Mesh(dotGeometry, dotMaterial);
      dot6c.position.set(-0.2, 0, -0.51);
      const dot6d = new THREE.Mesh(dotGeometry, dotMaterial);
      dot6d.position.set(0.2, 0, -0.51);
      const dot6e = new THREE.Mesh(dotGeometry, dotMaterial);
      dot6e.position.set(-0.2, -0.2, -0.51);
      const dot6f = new THREE.Mesh(dotGeometry, dotMaterial);
      dot6f.position.set(0.2, -0.2, -0.51);
      dice.add(dot6a);
      dice.add(dot6b);
      dice.add(dot6c);
      dice.add(dot6d);
      dice.add(dot6e);
      dice.add(dot6f);

      camera.position.z = 2;
      animateDice();
    }

    function animateDice() {
      requestAnimationFrame(animateDice);
      renderer.render(scene, camera);
    }

    function rollDiceAnimation(finalFace) {
      if (isRolling) return;
      isRolling = true;
      let rollTime = 0;
      const rollDuration = 1000;
      const rollInterval = setInterval(() => {
        rollTime += 16;
        dice.rotation.x += Math.random() * 0.5;
        dice.rotation.y += Math.random() * 0.5;
        if (rollTime >= rollDuration) {
          clearInterval(rollInterval);
          switch (finalFace) {
            case 1:
              dice.rotation.x = 0;
              dice.rotation.y = 0;
              break;
            case 2:
              dice.rotation.x = Math.PI;
              dice.rotation.y = 0;
              break;
            case 3:
              dice.rotation.x = Math.PI / 2;
              dice.rotation.y = 0;
              break;
            case 4:
              dice.rotation.x = -Math.PI / 2;
              dice.rotation.y = 0;
              break;
            case 5:
              dice.rotation.x = 0;
              dice.rotation.y = Math.PI / 2;
              break;
            case 6:
              dice.rotation.x = 0;
              dice.rotation.y = -Math.PI / 2;
              break;
          }
          isRolling = false;
        }
      }, 16);
    }

    // Khá»Ÿi táº¡o biá»ƒu Ä‘á»“ mÃ³n Äƒn
    function initFoodChart() {
      const ctx = document.getElementById('food-chart').getContext('2d');
      foodChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(foodResults),
          datasets: [{
            label: 'Sá»‘ láº§n Ä‘Æ°á»£c chá»n',
            data: Object.values(foodResults),
            backgroundColor: [
              'rgba(255, 99, 132, 0.7)',
              'rgba(54, 162, 235, 0.7)',
              'rgba(255, 206, 86, 0.7)',
              'rgba(75, 192, 192, 0.7)',
              'rgba(153, 102, 255, 0.7)',
              'rgba(255, 159, 64, 0.7)'
            ].slice(0, Object.keys(foodResults).length),
            borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)',
              'rgba(153, 102, 255, 1)',
              'rgba(255, 159, 64, 1)'
            ].slice(0, Object.keys(foodResults).length),
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Sá»‘ láº§n Ä‘Æ°á»£c chá»n',
                font: { family: 'Poppins', size: 14 }
              }
            },
            x: {
              title: {
                display: true,
                text: 'MÃ³n Äƒn',
                font: { family: 'Poppins', size: 14 }
              }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              enabled: true,
              callbacks: {
                label: function(context) {
                  return `${context.label}: ${context.raw} láº§n`;
                }
              }
            }
          }
        }
      });
    }

    // Cáº­p nháº­t biá»ƒu Ä‘á»“ mÃ³n Äƒn vÃ  thÃ´ng bÃ¡o mÃ³n Äƒn Ä‘Æ°á»£c chá»n nhiá»u nháº¥t
    function updateFoodChart() {
      let labels = Object.keys(foodResults);
      let data = Object.values(foodResults);

      if (showingTop5) {
        const sortedFoods = Object.entries(foodResults)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5);
        labels = sortedFoods.map(entry => entry[0]);
        data = sortedFoods.map(entry => entry[1]);
      }

      foodChart.data.labels = labels;
      foodChart.data.datasets[0].data = data;
      foodChart.data.datasets[0].backgroundColor = [
        'rgba(255, 99, 132, 0.7)',
        'rgba(54, 162, 235, 0.7)',
        'rgba(255, 206, 86, 0.7)',
        'rgba(75, 192, 192, 0.7)',
        'rgba(153, 102, 255, 0.7)',
        'rgba(255, 159, 64, 0.7)'
      ].slice(0, labels.length);
      foodChart.data.datasets[0].borderColor = [
        'rgba(255, 99, 132, 1)',
        'rgba(54, 162, 235, 1)',
        'rgba(255, 206, 86, 1)',
        'rgba(75, 192, 192, 1)',
        'rgba(153, 102, 255, 1)',
        'rgba(255, 159, 64, 1)'
      ].slice(0, labels.length);
      foodChart.update();

      // Cáº­p nháº­t thÃ´ng bÃ¡o mÃ³n Äƒn Ä‘Æ°á»£c chá»n nhiá»u nháº¥t
      const mostSelectedFood = Object.entries(foodResults)
        .sort((a, b) => b[1] - a[1])[0];
      const mostSelectedMessage = mostSelectedFood && mostSelectedFood[1] > 0
        ? `MÃ³n Äƒn Ä‘Æ°á»£c chá»n trÃºng nhiá»u nháº¥t cho bá»¯a trÆ°a mai lÃ  ${mostSelectedFood[0]} ğŸ‰`
        : 'ChÆ°a cÃ³ mÃ³n Äƒn nÃ o Ä‘Æ°á»£c chá»n.';
      document.getElementById('most-selected-food').textContent = mostSelectedMessage;
    }

    // Hiá»ƒn thá»‹ top 5 mÃ³n Äƒn
    function showTop5Foods() {
      showingTop5 = true;
      updateFoodChart();
    }

    // Hiá»ƒn thá»‹ táº¥t cáº£ mÃ³n Äƒn
    function showAllFoods() {
      showingTop5 = false;
      updateFoodChart();
    }

    // MÃ n hÃ¬nh Ä‘Äƒng nháº­p
    function login() {
      const nameInput = document.getElementById('player-name').value.trim();
      if (nameInput) {
        playerName = nameInput;
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-screen').classList.remove('hidden');
        document.getElementById('welcome-message').textContent = `ChÃ o ${playerName}!`;
        initFoodResults();
        updateFoodList();
        updateHistory();
        initDice();
        initFoodChart();
        updateFoodChart();
      } else {
        alert('Vui lÃ²ng nháº­p tÃªn cá»§a báº¡n!');
      }
    }

    // Cáº­p nháº­t danh sÃ¡ch mÃ³n Äƒn
    function updateFoodList() {
      const foodList = document.getElementById('food-list');
      foodList.innerHTML = '';
      foods.forEach((food, index) => {
        const li = document.createElement('li');
        li.className = 'list-item flex justify-between items-center p-2 rounded-lg';
        li.innerHTML = `
          ${food.name} (ÄÆ°á»£c thÃªm bá»Ÿi ${food.addedBy})
          <button onclick="deleteFood(${index})" class="btn bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600">XÃ³a</button>
        `;
        li.classList.add('animate__animated', 'animate__fadeIn');
        foodList.appendChild(li);
      });
    }

    // XÃ³a mÃ³n Äƒn
    function deleteFood(index) {
      const foodToDelete = foods[index].name;
      
      foods.splice(index, 1);
      history = history.filter(entry => {
        const match = entry.match(/(.+?) \(bá»Ÿi (.+)\)/);
        return match ? match[1] !== foodToDelete : true;
      });
      delete foodResults[foodToDelete];

      socket.emit('updateFoods', foods);
      socket.emit('updateHistory', history);
      socket.emit('updateFoodResults', foodResults);

      if (document.getElementById('result').textContent.includes(foodToDelete)) {
        document.getElementById('result').textContent = '';
      }
    }

    // Äá»• xÃºc xáº¯c vá»›i hiá»‡u á»©ng
    function rollDice() {
      if (foods.length === 0) {
        alert('HÃ£y thÃªm Ã­t nháº¥t má»™t mÃ³n Äƒn!');
        return;
      }
      const randomFace = Math.floor(Math.random() * 6) + 1;
      rollDiceAnimation(randomFace);
      setTimeout(() => {
        const randomIndex = Math.floor(Math.random() * foods.length);
        const selectedFood = foods[randomIndex].name;
        foodResults[selectedFood] = (foodResults[selectedFood] || 0) + 1;
        history.push(`${selectedFood} (bá»Ÿi ${playerName})`);
        document.getElementById('result').textContent = `MÃ³n Äƒn báº¡n chá»n trÃºng lÃ : ${selectedFood}`;
        document.getElementById('result').classList.add('animate__animated', 'animate__bounceIn');

        socket.emit('updateHistory', history);
        socket.emit('updateFoodResults', foodResults);
      }, 1000);
    }

    // Cáº­p nháº­t lá»‹ch sá»­
    function updateHistory() {
      const historyList = document.getElementById('history');
      historyList.innerHTML = '';
      history.forEach(item => {
        const li = document.createElement('li');
        li.className = 'list-item p-2 rounded-lg';
        li.textContent = item;
        li.classList.add('animate__animated', 'animate__fadeIn');
        historyList.appendChild(li);
      });
    }

    // ThÃªm mÃ³n Äƒn
    function addFood() {
      const newFood = document.getElementById('new-food').value.trim();
      if (newFood) {
        if (foods.some(food => food.name === newFood)) {
          alert('MÃ³n Äƒn nÃ y Ä‘Ã£ cÃ³ trong danh sÃ¡ch!');
          return;
        }
        const foodEntry = { name: newFood, addedBy: playerName };
        foods.push(foodEntry);
        if (!(newFood in foodResults)) {
          foodResults[newFood] = 0;
        }
        document.getElementById('new-food').value = '';

        socket.emit('updateFoods', foods);
        socket.emit('updateFoodResults', foodResults);
      } else {
        alert('Vui lÃ²ng nháº­p tÃªn mÃ³n Äƒn!');
      }
    }

    // LÃ m má»›i game
    function resetGame() {
      foods = [];
      history = [];
      expenses = [];
      foodResults = {};
      
      socket.emit('updateFoods', foods);
      socket.emit('updateHistory', history);
      socket.emit('updateFoodResults', foodResults);

      localStorage.setItem('expenses', JSON.stringify(expenses));
      document.getElementById('result').textContent = '';
      location.reload();
    }

    // Chuyá»ƒn sang mÃ n hÃ¬nh thu chi
    function goToFinance() {
      document.getElementById('main-screen').classList.add('hidden');
      document.getElementById('finance-screen').classList.remove('hidden');
      updateExpenseList();
    }

    // Quay láº¡i mÃ n hÃ¬nh chÃ­nh
    function goToMain() {
      document.getElementById('finance-screen').classList.add('hidden');
      document.getElementById('main-screen').classList.remove('hidden');
      updateFoodChart();
    }

    // Äá»‹nh dáº¡ng sá»‘ tiá»n vá»›i dáº¥u cháº¥m phÃ¢n cÃ¡ch
    function formatNumber(number) {
      return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }

    // ThÃªm chi phÃ­
    function addExpense() {
      const description = document.getElementById('expense-description').value.trim();
      const amount = parseFloat(document.getElementById('expense-amount').value);
      if (description && amount > 0) {
        expenses.push({ description, amount });
        document.getElementById('expense-description').value = '';
        document.getElementById('expense-amount').value = '';
        updateExpenseList();
        localStorage.setItem('expenses', JSON.stringify(expenses));
      } else {
        alert('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin chi phÃ­!');
      }
    }

    // Chá»‰nh sá»­a chi phÃ­
    function editExpense(index) {
      const expense = expenses[index];
      const li = document.getElementById(`expense-item-${index}`);
      li.innerHTML = `
        <div class="flex items-center justify-between p-2 rounded-lg">
          <div class="flex-1 flex space-x-2">
            <input id="edit-description-${index}" type="text" value="${expense.description}" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:outline-none w-1/2">
            <input id="edit-amount-${index}" type="number" value="${expense.amount}" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-400 focus:outline-none w-1/2">
          </div>
          <div class="flex space-x-1">
            <button onclick="saveExpense(${index})" class="btn bg-green-500 text-white px-2 py-1 rounded-lg hover:bg-green-600 text-sm">LÆ°u</button>
            <button onclick="updateExpenseList()" class="btn bg-gray-500 text-white px-2 py-1 rounded-lg hover:bg-gray-600 text-sm">Há»§y</button>
          </div>
        </div>
      `;
    }

    // LÆ°u chi phÃ­ Ä‘Ã£ chá»‰nh sá»­a
    function saveExpense(index) {
      const newDescription = document.getElementById(`edit-description-${index}`).value.trim();
      const newAmount = parseFloat(document.getElementById(`edit-amount-${index}`).value);
      if (newDescription && newAmount > 0) {
        expenses[index] = { description: newDescription, amount: newAmount };
        localStorage.setItem('expenses', JSON.stringify(expenses));
        updateExpenseList();
      } else {
        alert('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin chi phÃ­!');
      }
    }

    // XÃ³a chi phÃ­
    function deleteExpense(index) {
      expenses.splice(index, 1);
      localStorage.setItem('expenses', JSON.stringify(expenses));
      updateExpenseList();
    }

    // Cáº­p nháº­t danh sÃ¡ch thu chi
    function updateExpenseList() {
      const expenseList = document.getElementById('expense-list');
      expenseList.innerHTML = '';
      let total = 0;
      expenses.forEach((expense, index) => {
        const li = document.createElement('li');
        li.id = `expense-item-${index}`;
        li.className = 'list-item flex justify-between items-center p-2 rounded-lg';
        li.innerHTML = `
          <div class="flex-1">${expense.description}: ${formatNumber(expense.amount)} VND</div>
          <div class="flex space-x-1">
            <button onclick="editExpense(${index})" class="btn bg-blue-500 text-white px-2 py-1 rounded-lg hover:bg-blue-600 text-sm">Sá»¬A</button>
            <button onclick="deleteExpense(${index})" class="btn bg-red-500 text-white px-2 py-1 rounded-lg hover:bg-red-600 text-sm">XÃ“A</button>
          </div>
        `;
        li.classList.add('animate__animated', 'animate__fadeIn');
        expenseList.appendChild(li);
        total += expense.amount;
      });

      // Cáº­p nháº­t tá»•ng chi phÃ­
      document.getElementById('total-expense').textContent = `Tá»•ng cá»™ng: ${formatNumber(total)} VND`;

      // TÃ­nh sá»‘ tiá»n má»—i ngÆ°á»i pháº£i Ä‘Ã³ng
      const numberOfParticipants = parseInt(document.getElementById('number-of-participants').value) || 0;
      const perPersonExpense = numberOfParticipants > 0 ? Math.round(total / numberOfParticipants) : 0;
      document.getElementById('per-person-expense').textContent = numberOfParticipants > 0
        ? `Má»—i ngÆ°á»i pháº£i Ä‘Ã³ng: ${formatNumber(perPersonExpense)} VND (${numberOfParticipants} ngÆ°á»i)`
        : 'Vui lÃ²ng nháº­p sá»‘ ngÆ°á»i tham gia Äƒn.';
    }
  </script>
</body>
</html>
